(self.webpackChunkalecture=self.webpackChunkalecture||[]).push([[256],{5256:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>w});var n=l(2309),a=l(2545),r=l(9250),o=l(8678),s=l(2951),c=l(7753);const i=(0,c.Z)("div",{target:"enhg4lt1"})({name:"l986mw",styles:"display:flex;flex-wrap:wrap;height:calc(100vh - 38px);flex-flow:column"}),u=(0,c.Z)("header",{target:"enhg4lt0"})({name:"1ezwwi6",styles:"height:64px;display:flex;width:100%;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 1px 0 var(--saf-0);padding:20px 16px 20px 20px;font-weight:bold;align-items:center;& .header-right{display:flex;flex:1;justify-content:flex-end;align-items:center;}"});var d=l(3564),h=l(8667),p=l(9669),g=l.n(p),v=l(7294),m=l(5977),f=l(8100);const w=()=>{var e,t;const{workspace:l,channel:c}=(0,m.UO)(),{data:p}=(0,f.ZP)("/api/users",d.Z),[w,b,k]=(0,o.Z)(""),{data:x}=(0,f.ZP)(`/api/workspaces/${l}/channels/${c}`,d.Z),{data:Z,mutate:_,revalidate:C,setSize:E}=(0,f.g_)((e=>`/api/workspaces/${l}/channels/${c}/chats?perPage=20&page=${e+1}`),d.Z),{data:S}=(0,f.ZP)(p?`/api/workspaces/${l}/channels/${c}/members`:null,d.Z),[$]=(0,s.Z)(l),y=0===(null==Z||null===(e=Z[0])||void 0===e?void 0:e.length)||Z&&(null===(t=Z[Z.length-1])||void 0===t?void 0:t.length)<20||!1,T=(0,v.useRef)(null),[B,I]=(0,v.useState)(!1),P=(0,v.useCallback)((e=>{if(e.preventDefault(),console.log(w),null!=w&&w.trim()&&Z&&x){const e=w;_((t=>{var l;return null==t||t[0].unshift({id:((null===(l=Z[0][0])||void 0===l?void 0:l.id)||0)+1,content:e,UserId:p.id,User:p,ChannelId:x.id,Channel:x,createdAt:new Date}),t}),!1).then((()=>{var e;k(""),null===(e=T.current)||void 0===e||e.scrollToBottom()})),g().post(`/api/workspaces/${l}/channels/${c}/chats`,{content:w}).then((()=>{C()})).catch(console.error)}}),[w,Z,p,x,l,c]),U=(0,v.useCallback)((e=>{e.Channel.name===c&&e.UserId!==(null==p?void 0:p.id)&&_((t=>(null==t||t[0].unshift(e),t)),!1).then((()=>{var e;T.current&&T.current.getScrollHeight()<T.current.getScrollHeight()+T.current.getScrollTop()+150&&(console.log("scrollToBottom!",null===(e=T.current)||void 0===e?void 0:e.getValues()),setTimeout((()=>{var e;null===(e=T.current)||void 0===e||e.scrollToBottom()}),50))}))}),[c,p]);(0,v.useEffect)((()=>(null==$||$.on("message",U),()=>{null==$||$.off("message",U)})),[$,U]),(0,v.useEffect)((()=>{var e;1===(null==Z?void 0:Z.length)&&(null===(e=T.current)||void 0===e||e.scrollToBottom())}),[Z]);const z=(0,v.useCallback)((()=>{I(!0)}),[]),N=(0,v.useCallback)((()=>{I(!1)}),[]);if(!p||!p)return null;const R=(0,h.Z)(Z?Z.flat().reverse():[]);return v.createElement(i,null,v.createElement(u,null,v.createElement("span",null,"#",c),v.createElement("div",{className:"header-right"},v.createElement("span",null,null==S?void 0:S.length),v.createElement("button",{onClick:z,className:"c-button-unstyled p-ia__view_header__button","aria-label":"Add people to #react-native","data-sk":"tooltip_parent",type:"button"},v.createElement("i",{className:"c-icon p-ia__view_header__button_icon c-icon--add-user","aria-hidden":"true"})))),v.createElement(a.Z,{chatSections:R,scrollRef:T,setSize:E,isReachingEnd:y}),v.createElement(n.Z,{chat:w,onChangeChat:b,onSubmitForm:P}),v.createElement(r.Z,{show:B,onCloseModal:N,setShowInviteChannelModal:I}))}}}]);