(self.webpackChunkalecture=self.webpackChunkalecture||[]).push([[94],{3094:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>x});var n=l(2309),r=l(2545),a=l(8678),o=l(2951),c=l(7753);const s=(0,c.Z)("div",{target:"enpw7kx1"})({name:"l986mw",styles:"display:flex;flex-wrap:wrap;height:calc(100vh - 38px);flex-flow:column"}),i=(0,c.Z)("header",{target:"enpw7kx0"})({name:"1c17pcy",styles:"height:64px;display:flex;width:100%;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 1px 0 var(--saf-0);padding:20px 16px 20px 20px;font-weight:bold;align-items:center;& img{margin-right:5px;}"});var u=l(3564),d=l(8667),p=l(9669),h=l.n(p),m=l(7294),g=l(6182),v=l.n(g),f=l(5977),w=l(8100);const x=()=>{var e,t;const{workspace:l,id:c}=(0,f.UO)(),{data:p}=(0,w.ZP)(`/api/workspaces/${l}/users/${c}`,u.Z),{data:g}=(0,w.ZP)("/api/users",u.Z),[x,k,Z]=(0,a.Z)(""),{data:b,mutate:E,revalidate:S,setSize:C}=(0,w.g_)((e=>`/api/workspaces/${l}/dms/${c}/chats?perPage=20&page=${e+1}`),u.Z),[$]=(0,o.Z)(l),T=0===(null==b||null===(e=b[0])||void 0===e?void 0:e.length)||b&&(null===(t=b[b.length-1])||void 0===t?void 0:t.length)<20||!1,y=(0,m.useRef)(null),R=(0,m.useCallback)((e=>{if(e.preventDefault(),console.log(x),null!=x&&x.trim()&&b){const e=x;E((t=>{var l;return null==t||t[0].unshift({id:((null===(l=b[0][0])||void 0===l?void 0:l.id)||0)+1,content:e,SenderId:g.id,Sender:g,ReceiverId:p.id,Receiver:p,createdAt:new Date}),t}),!1).then((()=>{var e;Z(""),null===(e=y.current)||void 0===e||e.scrollToBottom()})),h().post(`/api/workspaces/${l}/dms/${c}/chats`,{content:x}).then((()=>{S()})).catch(console.error)}}),[x,b,g,p,l,c]),B=(0,m.useCallback)((e=>{e.SenderId===Number(c)&&g.id!==Number(c)&&E((t=>(null==t||t[0].unshift(e),t)),!1).then((()=>{var e;y.current&&y.current.getScrollHeight()<y.current.getClientHeight()+y.current.getScrollTop()+150&&(console.log("scrollToBottom!",null===(e=y.current)||void 0===e?void 0:e.getValues()),setTimeout((()=>{var e;null===(e=y.current)||void 0===e||e.scrollToBottom()}),50))}))}),[]);if((0,m.useEffect)((()=>(null==$||$.on("dm",B),()=>{null==$||$.off("dm",B)})),[$,B]),(0,m.useEffect)((()=>{var e;1===(null==b?void 0:b.length)&&(null===(e=y.current)||void 0===e||e.scrollToBottom())}),[b]),!p||!g)return null;const I=(0,d.Z)(b?b.flat().reverse():[]);return m.createElement(s,null,m.createElement(i,null,m.createElement("img",{src:v().url(p.email,{s:"24px",d:"retro"}),alt:p.nickname}),m.createElement("span",null,p.nickname)),m.createElement(r.Z,{chatSections:I,scrollRef:y,setSize:C,isReachingEnd:T}),m.createElement(n.Z,{chat:x,onChangeChat:k,onSubmitForm:R}))}}}]);